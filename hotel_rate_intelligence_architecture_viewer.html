<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hotel Rate Intelligence — Architecture Viewer</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#111a2e; --panel2:#0f1830;
      --text:#e8eefc; --muted:#a8b3d6; --border:#2a355a; --accent:#9cc0ff;
      --good:#46d17d; --warn:#ffb86b; --bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Pretendard",Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    header{padding:14px 18px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(11,18,32,.92);backdrop-filter:blur(6px);z-index:10}
    header h1{margin:0 0 6px 0;font-size:16px;font-weight:900}
    header .sub{font-size:12px;color:var(--muted);line-height:1.5;max-width:1200px}
    main{padding:14px 18px 26px;display:grid;grid-template-columns: 520px 1fr;gap:14px}
    .card{border:1px solid var(--border);background:var(--panel);border-radius:12px;padding:12px}
    .card h2{margin:0 0 10px 0;font-size:13px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{font-size:12px;border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:var(--panel2);color:var(--muted)}
    .pill b{color:var(--text)}
    .btn{border:1px solid var(--border);background:var(--panel2);color:var(--text);padding:7px 10px;border-radius:10px;cursor:pointer;font-size:12px}
    .btn:hover{filter:brightness(1.06)}
    input[type="range"]{width:220px}
    .hr{height:1px;background:var(--border);margin:12px 0}
    .small{font-size:12px;color:var(--muted);line-height:1.45}
    .viewport{border:1px solid var(--border);border-radius:12px;background:#fff;overflow:auto;height: calc(100vh - 210px);}
    .svgwrap{transform-origin:0 0; display:inline-block}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04);font-size:11px;color:var(--muted)}
    code{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
  </style>
</head>
<body>
<header>
  <h1>Hotel Rate Intelligence — Architecture Viewer</h1>
  <div class="sub">
    단일 파일로 동작합니다(외부 CDN 없음). · Zoom/다운로드 지원<br/>
    원칙: Server는 <b>추천/근거/로그</b>만, Wings CMS 변경은 <b>MV3 확장</b>에서 <b>승인(Apply)</b> 후 수행.
  </div>
</header>

<main>
  <div class="card">
    <h2>요약</h2>
    <div class="small">
      <span class="badge">핵심</span> 경쟁가 + PMS → 추천가 산출 → 승인 기반 Wings CMS 반영 → 재조회 검증 → Action Log<br/>
      <span class="badge">보안</span> Wings 세션/쿠키는 브라우저 내부에만 유지 (서버 저장/전송 금지)
    </div>

    <div class="hr"></div>

    <h2>Controls</h2>
    <div class="row">
      <span class="pill">Zoom: <b><span id="zoomOut">100%</span></b></span>
      <input id="zoom" type="range" min="50" max="180" value="100" />
      <button class="btn" id="reset">Reset</button>
    </div>
    <div class="row" style="margin-top:8px">
      <a class="btn" href="hotel_rate_intelligence_architecture_v4.svg" download>Download SVG</a>
      <button class="btn" id="copyLink">Copy file name</button>
    </div>

    <div class="hr"></div>

    <h2>What changed (v4)</h2>
    <div class="small">
      • <code>Signals Ingest → Context Builder</code> 데이터 흐름(경쟁가→컨텍스트)을 추가했습니다.<br/>
      • <code>Apply 후 재조회(Read)</code> 검증 화살표를 추가했습니다.<br/>
      • <code>Apply 실패</code> 경로(점선 빨강)와 “알림/재시도”를 명시했습니다.<br/>
      • Wings PMS/CMS는 <b>동일 브라우저 세션</b>이라는 주석(점선 연결)을 추가했습니다.
    </div>
  </div>

  <div class="card" style="padding:10px">
    <h2 style="margin-bottom:10px">Architecture Diagram</h2>
    <div class="viewport">
      <div id="svgWrap" class="svgwrap"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1700" height="1010" viewBox="0 0 1700 1010" role="img" aria-label="Hotel Rate Intelligence architecture (server recommends only, client executes)">
<defs>

  <style>
    :root {
      --bg:#0b1220;
      --panel:#111a2e;
      --panel2:#0f1830;
      --text:#e8eefc;
      --muted:#a8b3d6;
      --border:#2a355a;
      --accent:#9cc0ff;
      --gold:#D4AF37;
      --warn:#ffb86b;
      --bad:#ff6b6b;
    }
    .title { font: 800 24px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--text); }
    .subtitle { font: 600 13px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--muted); }
    .colhdr { font: 800 13px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--muted); letter-spacing: .2px; }
    .lanehdr { font: 900 13px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--text); }
    .lanesub { font: 600 12px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--muted); }
    .boxTitle { font: 900 14px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--text); }
    .boxBody { font: 600 12px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--muted); }
    .noteTitle { font: 900 13px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--text); }
    .noteBody { font: 600 12px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--muted); }

    /* arrows */
    .arrowA { stroke: var(--accent); stroke-width: 2.0; }
    .arrowG { stroke: var(--gold); stroke-width: 2.4; }
    .arrowM { stroke: var(--muted); stroke-width: 1.8; stroke-dasharray: 6 5; opacity: .95; }
    .arrowV { stroke: var(--accent); stroke-width: 1.8; stroke-dasharray: 4 4; opacity: .95; }
    .arrowE { stroke: var(--bad); stroke-width: 1.9; stroke-dasharray: 4 4; opacity: .95; }

    .dashCol { stroke: var(--muted); stroke-width: 1.6; stroke-dasharray: 4 4; opacity: .85; }

    .pill { fill: rgba(255,255,255,.03); stroke: var(--border); stroke-width: 1.2; }
    .lbl { font: 700 11px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--muted); }
    .lblAccent { font: 800 11px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--accent); }
    .lblGold { font: 800 11px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--gold); }
    .lblBad { font: 800 11px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--bad); }

    .tag { fill: rgba(212,175,55,.14); stroke: rgba(212,175,55,.55); stroke-width: 1.2; }
    .tagTxt { font: 900 10px ui-sans-serif, system-ui, -apple-system, "Pretendard", Segoe UI, Roboto, Arial; fill: var(--gold); letter-spacing: .4px; }
  </style>

  <marker id="arrowAccent" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
    <path d="M 0 0 L 8 4 L 0 8 z" fill="#9cc0ff"/>
  </marker>
  <marker id="arrowGold" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
    <path d="M 0 0 L 8 4 L 0 8 z" fill="#D4AF37"/>
  </marker>
  <marker id="arrowMuted" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
    <path d="M 0 0 L 8 4 L 0 8 z" fill="#a8b3d6"/>
  </marker>
  <marker id="arrowBad" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
    <path d="M 0 0 L 8 4 L 0 8 z" fill="#ff6b6b"/>
  </marker>
</defs>

<rect x="0" y="0" width="1700" height="1010" rx="0" ry="0" fill="#0b1220"  stroke-width="0" opacity="1.0"/>
<text x="40" y="52" class="title" text-anchor="start">Hotel Rate Intelligence — Wings 기반 요금 운영 자동화 (Server 추천-only, Client 실행)</text>
<text x="40" y="78" class="subtitle" text-anchor="start">서버는 추천/근거/로그 저장만. Wings CMS 실제 변경은 브라우저 확장(MV3)에서 사용자 승인 후 수행.</text>
<text x="460.0" y="132" class="colhdr" text-anchor="middle">External Systems</text>
<text x="950.0" y="132" class="colhdr" text-anchor="middle">Client (Browser + MV3 Extension)</text>
<text x="1440.0" y="132" class="colhdr" text-anchor="middle">L.O.N Cloud (Recommendation Only)</text>
<rect x="40" y="180" width="1620" height="195" rx="16" ry="16" fill="#111a2e" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<text x="58" y="220" class="lanehdr" text-anchor="start">1) 경쟁가 수집</text>
<text x="58" y="240" class="lanesub" text-anchor="start">Agoda/Booking 등 OTA 웹에서 경쟁 호텔 가격을 수집</text>
<rect x="280" y="220" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="770" y="220" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="1260" y="220" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="40" y="400" width="1620" height="195" rx="16" ry="16" fill="#111a2e" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<text x="58" y="440" class="lanehdr" text-anchor="start">2) 내 호텔 수요/실적 수집</text>
<text x="58" y="460" class="lanesub" text-anchor="start">Wings PMS에서 예약/점유/ADR 등 스냅샷 수집</text>
<rect x="280" y="440" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="770" y="440" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="1260" y="440" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="40" y="620" width="1620" height="195" rx="16" ry="16" fill="#111a2e" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<text x="58" y="660" class="lanehdr" text-anchor="start">3) 추천 → 승인 → 반영 → 검증</text>
<text x="58" y="680" class="lanesub" text-anchor="start">추천가·근거 확인 후 Apply, Wings CMS에 반영하고 결과를 Action Log로 기록</text>
<rect x="280" y="660" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="770" y="660" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<rect x="1260" y="660" width="360" height="120" rx="14" ry="14" fill="#0f1830" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<text x="298" y="254" class="boxTitle" text-anchor="start">OTA Web Pages</text>
<text x="298" y="278" class="boxBody" text-anchor="start">• Agoda / Booking / 기타</text>
<text x="298" y="296" class="boxBody" text-anchor="start">• DOM 기반 경쟁가 파싱</text>
<text x="788" y="254" class="boxTitle" text-anchor="start">MV3 Collector</text>
<text x="788" y="278" class="boxBody" text-anchor="start">• Comp Set 기준 수집</text>
<text x="788" y="296" class="boxBody" text-anchor="start">• 룸/날짜별 가격 정규화</text>
<text x="788" y="314" class="boxBody" text-anchor="start">• observations 생성</text>
<text x="1278" y="254" class="boxTitle" text-anchor="start">Signals Ingest API</text>
<text x="1278" y="278" class="boxBody" text-anchor="start">• observations 저장</text>
<text x="1278" y="296" class="boxBody" text-anchor="start">• 중복/품질 체크</text>
<text x="1278" y="314" class="boxBody" text-anchor="start">• 최신성 지표 산출</text>
<text x="298" y="474" class="boxTitle" text-anchor="start">Wings PMS</text>
<text x="298" y="498" class="boxBody" text-anchor="start">• 예약률 / ADR / 매출</text>
<text x="298" y="516" class="boxBody" text-anchor="start">• 호텔 운영 지표</text>
<text x="788" y="474" class="boxTitle" text-anchor="start">PMS Reader</text>
<text x="788" y="498" class="boxBody" text-anchor="start">• 브라우저 세션 기반 조회</text>
<text x="788" y="516" class="boxBody" text-anchor="start">• 스냅샷 생성(OTB 등)</text>
<text x="788" y="534" class="boxBody" text-anchor="start">• 서버로 업로드</text>
<text x="1278" y="474" class="boxTitle" text-anchor="start">Context Builder</text>
<text x="1278" y="498" class="boxBody" text-anchor="start">• PMS + 경쟁가 결합</text>
<text x="1278" y="516" class="boxBody" text-anchor="start">• 시즌/요일/이벤트 반영</text>
<text x="1278" y="534" class="boxBody" text-anchor="start">• 추천 입력 컨텍스트</text>
<text x="298" y="694" class="boxTitle" text-anchor="start">Wings CMS</text>
<text x="298" y="718" class="boxBody" text-anchor="start">• 요금/재고 관리 UI</text>
<text x="298" y="736" class="boxBody" text-anchor="start">• Procedure API</text>
<text x="298" y="754" class="boxBody" text-anchor="start">• 세션 쿠키 기반</text>
<text x="788" y="694" class="boxTitle" text-anchor="start">Decision Panel + Executor</text>
<text x="788" y="718" class="boxBody" text-anchor="start">• 추천가 + 근거 + diff</text>
<text x="788" y="736" class="boxBody" text-anchor="start">• 승인(Apply) 후 실행</text>
<text x="788" y="754" class="boxBody" text-anchor="start">• Write 후 Read로 검증</text>
<text x="788" y="772" class="boxBody" text-anchor="start">• 실패 시 알림/재시도</text>
<text x="1278" y="694" class="boxTitle" text-anchor="start">Recommendation API + Engine</text>
<text x="1278" y="718" class="boxBody" text-anchor="start">• 최적 요금 산출(가드레일)</text>
<text x="1278" y="736" class="boxBody" text-anchor="start">• 추천/근거 응답</text>
<text x="1278" y="754" class="boxBody" text-anchor="start">• Action Log 저장(성공/실패)</text>
<rect x="1060" y="676" width="52" height="18" rx="9" ry="9" fill="rgba(212,175,55,.14)" stroke="rgba(212,175,55,.55)" stroke-width="1.2" opacity="1.0"/>
<text x="1086.0" y="688.5" class="tagTxt" text-anchor="middle">DEMO</text>
<rect x="1550" y="676" width="52" height="18" rx="9" ry="9" fill="rgba(212,175,55,.14)" stroke="rgba(212,175,55,.55)" stroke-width="1.2" opacity="1.0"/>
<text x="1576.0" y="688.5" class="tagTxt" text-anchor="middle">DEMO</text>
<line x1="650" y1="254" x2="760" y2="254" class="arrowA" marker-end="url(#arrowAccent)"/>
<rect x="674.3" y="240" width="61.4" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="705.0" y="253" class="lblAccent" text-anchor="middle">수집(DOM)</text>
<line x1="1140" y1="254" x2="1250" y2="254" class="arrowA" marker-end="url(#arrowAccent)"/>
<rect x="1161.2" y="240" width="67.6" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1195.0" y="253" class="lblAccent" text-anchor="middle">업로드(obs)</text>
<line x1="650" y1="474" x2="760" y2="474" class="arrowA" marker-end="url(#arrowAccent)"/>
<rect x="677.4" y="460" width="55.2" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="705.0" y="473" class="lblAccent" text-anchor="middle">PMS 읽기</text>
<line x1="1140" y1="474" x2="1250" y2="474" class="arrowA" marker-end="url(#arrowAccent)"/>
<rect x="1161.2" y="460" width="67.6" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1195.0" y="473" class="lblAccent" text-anchor="middle">업로드(PMS)</text>
<line x1="1140" y1="690" x2="1250" y2="690" class="arrowA" marker-end="url(#arrowAccent)"/>
<rect x="1170.5" y="676" width="49.0" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1195.0" y="689" class="lblAccent" text-anchor="middle">추천 요청</text>
<line x1="1250" y1="714" x2="1140" y2="714" class="arrowA" marker-end="url(#arrowAccent)"/>
<rect x="1170.5" y="700" width="49.0" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1195.0" y="713" class="lblAccent" text-anchor="middle">추천 응답</text>
<line x1="760" y1="746" x2="650" y2="746" class="arrowG" marker-end="url(#arrowGold)"/>
<rect x="665.0" y="732" width="80.0" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="705.0" y="745" class="lblGold" text-anchor="middle">Apply(CUD)</text>
<line x1="650" y1="764" x2="760" y2="764" class="arrowV" marker-end="url(#arrowAccent)"/>
<rect x="668.1" y="750" width="73.80000000000001" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="705.0" y="763" class="lblAccent" text-anchor="middle">재조회(Read)</text>
<line x1="650" y1="778" x2="760" y2="778" class="arrowE" marker-end="url(#arrowBad)"/>
<rect x="668.1" y="764" width="73.80000000000001" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="705.0" y="777" class="lblBad" text-anchor="middle">실패→알림/재시도</text>
<line x1="1140" y1="792" x2="1250" y2="792" class="arrowM" marker-end="url(#arrowMuted)"/>
<rect x="1155.0" y="778" width="80.0" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1195.0" y="791" class="lbl" text-anchor="middle">Action Log</text>
<line x1="1440.0" y1="348" x2="1440.0" y2="432" class="arrowM" marker-end="url(#arrowMuted)"/>
<rect x="1474.7" y="376.0" width="98.60000000000001" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1524.0" y="389.0" class="lbl" text-anchor="middle">obs → context</text>
<line x1="1440.0" y1="568" x2="1440.0" y2="652" class="arrowM" marker-end="url(#arrowMuted)"/>
<rect x="1477.8" y="596.0" width="92.4" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="1524.0" y="609.0" class="lbl" text-anchor="middle">context → 추천</text>
<line x1="460.0" y1="566" x2="460.0" y2="654" class="dashCol"/>
<rect x="518.3" y="596.0" width="123.4" height="18" rx="9" ry="9" fill="rgba(255,255,255,.03)" stroke="#2a355a" stroke-width="1.1" opacity="1.0"/>
<text x="580.0" y="609.0" class="lbl" text-anchor="middle">동일 Wings 세션(브라우저)</text>
<rect x="40" y="860" width="1620" height="120" rx="16" ry="16" fill="#111a2e" stroke="#2a355a" stroke-width="2" opacity="1.0"/>
<text x="58" y="894" class="noteTitle" text-anchor="start">운영/리스크 가드레일 + 데모 포인트</text>
<text x="58" y="920" class="noteBody" text-anchor="start">• 대외 메시지: '공식 연동/자동 반영' 표현 금지 → '분석/모니터링/추천' 중심</text>
<text x="58" y="940" class="noteBody" text-anchor="start">• Wings 세션/쿠키는 브라우저 내부에만 유지(서버 저장/전송 금지)</text>
<text x="58" y="960" class="noteBody" text-anchor="start">• 데모: (1) 추천가 diff+근거 패널, (2) Action Log 변경 이력/검증 결과</text>
</svg></div>
    </div>
    <div class="small" style="margin-top:10px">
      팁: SVG는 확대해도 깨지지 않습니다. README/Notion/Confluence에 그대로 첨부 가능합니다.
    </div>
  </div>
</main>

<script>
  const zoom = document.getElementById('zoom');
  const zoomOut = document.getElementById('zoomOut');
  const svgWrap = document.getElementById('svgWrap');
  const resetBtn = document.getElementById('reset');
  const copyBtn = document.getElementById('copyLink');

  function applyZoom() {
    const v = parseInt(zoom.value, 10);
    zoomOut.textContent = v + '%';
    svgWrap.style.transform = 'scale(' + (v/100) + ')';
  }
  zoom.addEventListener('input', applyZoom);
  resetBtn.addEventListener('click', () => {
    zoom.value = 100;
    applyZoom();
  });
  copyBtn.addEventListener('click', async () => {
    const txt = 'hotel_rate_intelligence_architecture_v4.svg';
    try {
      await navigator.clipboard.writeText(txt);
      alert('Copied: ' + txt);
    } catch(e) {
      prompt('Copy this:', txt);
    }
  });
  applyZoom();
</script>
</body>
</html>
