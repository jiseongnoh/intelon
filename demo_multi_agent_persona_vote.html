<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RateRocket SimLab â€” Multi-Agent + Persona Vote Demo</title>
  <style>
    :root{
      --bg:#0b1020;
      --text:#e9eeff;
      --muted:#aab6e6;
      --line:rgba(255,255,255,.08);
      --accent:#7aa2ff;
      --accent2:#52e0c4;
      --warn:#ffcc66;
      --danger:#ff6b6b;
      --shadow:0 12px 40px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      background: radial-gradient(1200px 800px at 10% 0%, rgba(122,162,255,.22), transparent 60%),
                  radial-gradient(1000px 700px at 90% 10%, rgba(82,224,196,.18), transparent 60%),
                  var(--bg);
      color: var(--text);
    }
    .app{ max-width:1250px; margin:0 auto; padding:24px; }

    header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:16px;
      margin-bottom:14px;
    }
    .title h1{ margin:0; font-size:20px; letter-spacing:.2px; }
    .title p{ margin:6px 0 0 0; color:var(--muted); font-size:13px; line-height:1.45; max-width:920px;}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      background:rgba(255,255,255,.04); color:var(--muted); font-size:12px; white-space:nowrap;
    }
    .dot{
      width:10px;height:10px;border-radius:50%;
      background:var(--accent2);
      box-shadow:0 0 0 6px rgba(82,224,196,.15);
    }

    .controls{
      display:flex; flex-wrap:wrap; align-items:center; gap:10px;
      padding:12px; border:1px solid var(--line); border-radius: var(--radius);
      background: rgba(255,255,255,.03); box-shadow: var(--shadow);
      margin-bottom:16px;
    }
    button{
      appearance:none; border:1px solid var(--line); background: rgba(255,255,255,.04);
      color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease;
      font-weight:700; font-size:13px;
    }
    button:hover{ background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.15); }
    button:active{ transform: translateY(1px); }
    .controls .group{ display:flex; align-items:center; gap:10px; padding-right:10px; border-right:1px solid var(--line); }
    .controls .group:last-child{ border-right:none; padding-right:0; }
    .label{ font-size:12px; color:var(--muted); margin-right:6px; }
    input[type="range"]{ width:220px; accent-color: var(--accent); }
    .time{
      font-variant-numeric: tabular-nums;
      font-size:13px; color:var(--text);
      padding:8px 10px; border:1px solid var(--line); border-radius:12px;
      background:rgba(0,0,0,.15); min-width:170px; text-align:center;
    }
    .toggle{
      display:flex; align-items:center; gap:8px;
      border:1px solid var(--line); background:rgba(255,255,255,.04);
      padding:8px 10px; border-radius:12px;
      font-size:12px; color:var(--muted);
    }
    .toggle input{ accent-color: var(--accent2); }

    .layout{ display:flex; gap:16px; align-items:stretch; }
    aside{
      width:360px; min-width:320px;
      border:1px solid var(--line); border-radius: var(--radius);
      background: rgba(255,255,255,.03); box-shadow: var(--shadow);
      overflow:hidden;
    }
    .timelineHeader{ padding:14px 14px 10px 14px; border-bottom:1px solid var(--line); background: rgba(255,255,255,.02); }
    .timelineHeader .h{ font-weight:800; font-size:14px; margin:0 0 6px 0; }
    .timelineHeader .sub{ margin:0; color:var(--muted); font-size:12px; line-height:1.35; }
    ul.timeline{ list-style:none; padding:0; margin:0; }
    .step{
      position:relative; padding:14px; border-bottom:1px solid var(--line);
      display:flex; gap:12px; align-items:flex-start; cursor:pointer; transition: background .2s ease;
    }
    .step:hover{ background: rgba(255,255,255,.03); }
    .step:last-child{ border-bottom:none; }
    .step .idx{
      width:28px; height:28px; border-radius:10px; display:flex; align-items:center; justify-content:center;
      background: rgba(122,162,255,.10); border:1px solid rgba(122,162,255,.22);
      color: var(--text); font-weight:900; font-size:12px; flex:0 0 auto;
    }
    .step .meta{ flex:1 1 auto; }
    .step .meta .range{ color:var(--muted); font-size:12px; margin:0 0 3px 0; font-variant-numeric: tabular-nums; }
    .step .meta .name{ margin:0; font-size:13px; font-weight:900; }
    .step .meta .desc{ margin:6px 0 0 0; color:var(--muted); font-size:12px; line-height:1.35; }
    .step.active{ background: rgba(82,224,196,.10); }
    .step.active .idx{ background: rgba(82,224,196,.16); border-color: rgba(82,224,196,.35); }
    .step.active::before{
      content:""; position:absolute; left:0; top:0; bottom:0; width:4px;
      background: linear-gradient(180deg, var(--accent2), var(--accent));
    }

    main{
      flex:1 1 auto;
      border:1px solid var(--line); border-radius: var(--radius);
      background: rgba(255,255,255,.03); box-shadow: var(--shadow);
      overflow:hidden; position:relative; min-height:585px;
    }
    .stageHeader{
      padding:14px 14px 10px 14px; border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      background: rgba(255,255,255,.02);
    }
    .stageHeader .left .kicker{ font-size:12px; color:var(--muted); margin:0 0 4px 0; }
    .stageHeader .left .big{ margin:0; font-weight:900; font-size:15px; letter-spacing:.2px; }
    .stageHeader .right{ display:flex; gap:10px; align-items:center; }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line);
      border-radius:999px; background:rgba(0,0,0,.14);
      color:var(--muted); font-size:12px; white-space:nowrap;
    }
    .tag .miniDot{
      width:8px;height:8px;border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 0 5px rgba(122,162,255,.15);
    }
    .tag.agent .miniDot{ background: var(--accent2); box-shadow:0 0 0 5px rgba(82,224,196,.15); }

    .progressWrap{ padding:0 14px 14px 14px; background: rgba(255,255,255,.02); border-bottom:1px solid var(--line); }
    .progressBar{
      height:10px; border-radius:999px; background: rgba(255,255,255,.07);
      border:1px solid var(--line); overflow:hidden; position:relative;
    }
    .progressBar > span{
      position:absolute; left:0; top:0; bottom:0; width:0%;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      border-radius:999px; transition: width .12s linear;
    }

    .scenes{ position:relative; height: calc(100% - 116px); padding:18px; }
    .scene{
      position:absolute; inset:18px; border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line); padding:18px; opacity:0; transform: translateY(10px);
      pointer-events:none; transition: opacity .25s ease, transform .25s ease; overflow:hidden;
    }
    .scene.active{ opacity:1; transform: translateY(0); pointer-events:auto; }
    .scene h3{ margin:0 0 10px 0; font-size:16px; letter-spacing:.2px; }
    .scene p{ margin:0 0 14px 0; color:var(--muted); line-height:1.5; font-size:13px; }

    .grid2{
      display:grid; grid-template-columns: 1.05fr .95fr; gap:14px; align-items:stretch;
      height: calc(100% - 70px);
    }
    .card{
      border:1px solid var(--line); border-radius:16px; background: rgba(0,0,0,.12);
      padding:14px; overflow:hidden;
    }
    .cardTitle{ display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
    .cardTitle .t{ font-weight:900; font-size:13px; margin:0; }
    .pill{
      font-size:11px; color:var(--muted); border:1px solid var(--line);
      background: rgba(255,255,255,.04); border-radius:999px; padding:6px 8px; white-space:nowrap;
    }

    /* UI mini components */
    .signals{ display:flex; flex-wrap:wrap; gap:10px; }
    .signal{
      border:1px solid var(--line); background: rgba(255,255,255,.04);
      border-radius: 14px; padding:10px 12px; display:flex; gap:10px;
      align-items:center; min-width: 215px; opacity:.95;
    }
    .signal b{ font-size:13px; }
    .signal span{ font-size:12px; color:var(--muted); display:block; margin-top:2px; }
    .icon{
      width:34px;height:34px;border-radius:12px; display:flex;align-items:center;justify-content:center;
      background: rgba(122,162,255,.15); border:1px solid rgba(122,162,255,.25); flex:0 0 auto;
    }
    .icon.green{ background: rgba(82,224,196,.12); border-color: rgba(82,224,196,.25); }
    .icon.warn{ background: rgba(255,204,102,.12); border-color: rgba(255,204,102,.25); }

    .tabs{ display:flex; gap:10px; margin-bottom:10px; }
    .tab{
      flex:1 1 auto; border:1px solid var(--line); background: rgba(255,255,255,.03);
      border-radius:14px; padding:10px 12px; font-size:12px; color:var(--muted);
      text-align:center; position:relative; overflow:hidden;
    }
    .tab.active{ color: var(--text); border-color: rgba(122,162,255,.35); background: rgba(122,162,255,.10); }
    .calendar{ display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; margin-top:10px; }
    .day{ height:34px; border-radius:10px; border:1px solid var(--line); background: rgba(255,255,255,.03); }
    .day.hot{ background: rgba(255,204,102,.10); border-color: rgba(255,204,102,.20); }
    .day.mid{ background: rgba(122,162,255,.10); border-color: rgba(122,162,255,.22); }
    .day.cool{ background: rgba(82,224,196,.10); border-color: rgba(82,224,196,.22); }

    .priceBox{
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px;
      padding:12px; border-radius:14px; border:1px solid var(--line);
      background: rgba(255,255,255,.03); margin-bottom:10px;
    }
    .priceBox .bigPrice{ font-size:22px; font-weight:900; letter-spacing:.3px; }
    .priceBox .small{ color:var(--muted); font-size:12px; }

    .bars{ display:flex; flex-direction:column; gap:10px; margin-top:8px; }
    .barRow{ display:grid; grid-template-columns: 110px 1fr 44px; gap:10px; align-items:center; font-size:12px; color:var(--muted); }
    .bar{ height:10px; border-radius:999px; background: rgba(255,255,255,.07); border:1px solid var(--line); overflow:hidden; }
    .bar > span{ display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--accent2), var(--accent)); border-radius:999px; }
    .scene3.active .bar > span{ animation: grow .8s ease-out .05s both; }
    @keyframes grow { from { width:0%; } to { width: var(--w); } }
    .warnBox{
      margin-top:10px; padding:10px 12px; border-radius:14px;
      border:1px dashed rgba(255,204,102,.35);
      background: rgba(255,204,102,.08); color: var(--text); font-size:12px;
    }

    .table{ width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:14px; border:1px solid var(--line); background: rgba(255,255,255,.02); }
    .table th, .table td{ padding:10px 12px; border-bottom:1px solid var(--line); font-size:12px; color:var(--muted); }
    .table th{ color: var(--text); background: rgba(255,255,255,.03); text-align:left; font-weight:800; }
    .table tr:last-child td{ border-bottom:none; }
    .editPencil{
      display:inline-flex; width:18px;height:18px; border-radius:6px; align-items:center;justify-content:center;
      border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.18); margin-left:8px; color:var(--muted); font-weight:900;
    }

    /* Multi-agent chat */
    .chatWrap{ height:100%; display:flex; flex-direction:column; gap:10px; }
    .chatHeader{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(255,255,255,.03);
    }
    .chatHeader .left{ display:flex; align-items:center; gap:10px; }
    .roomDot{
      width:10px;height:10px;border-radius:50%;
      background: var(--accent2);
      box-shadow: 0 0 0 6px rgba(82,224,196,.15);
    }
    .chatHeader .title{ margin:0; font-weight:900; font-size:13px; }
    .chatHeader .hint{ margin:0; color: var(--muted); font-size:12px; }

    .chatLog{
      flex:1 1 auto;
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(0,0,0,.12);
      overflow:auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .msg{ display:flex; gap:10px; align-items:flex-start; }
    .avatar{
      width:34px;height:34px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      display:flex; align-items:center; justify-content:center;
      background: rgba(255,255,255,.04);
      flex:0 0 auto;
      font-weight:900;
      color: var(--text);
    }
    .bubble{
      flex:1 1 auto;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:10px 12px;
      position:relative;
      overflow:hidden;
    }
    .bubble .meta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:6px;
      font-size:12px;
    }
    .bubble .meta .name{
      font-weight:900;
      color: var(--text);
      display:flex;
      gap:8px;
      align-items:center;
    }
    .role{
      font-size:11px;
      color: var(--muted);
      border:1px solid var(--line);
      background: rgba(0,0,0,.12);
      padding:4px 8px;
      border-radius:999px;
      white-space:nowrap;
    }
    .bubble .meta .ts{
      color: rgba(233,238,255,.60);
      font-variant-numeric: tabular-nums;
      font-size:11px;
      white-space:nowrap;
    }
    .bubble .text{ font-size:13px; line-height:1.45; color: var(--text); }
    .bubble .sub{ font-size:12px; color: var(--muted); margin-top:6px; line-height:1.45; }

    .kv{
      margin-top:8px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding:8px 10px;
      display:grid;
      grid-template-columns: 150px 1fr;
      gap:6px 10px;
      font-size:12px;
      color: rgba(233,238,255,.78);
    }
    .kv .k{ color: rgba(233,238,255,.55); }
    .kv .v{ color: rgba(233,238,255,.88); font-variant-numeric: tabular-nums; }

    .pillOk{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(82,224,196,.30);
      background: rgba(82,224,196,.10);
      color: rgba(233,238,255,.90);
      white-space:nowrap;
    }
    .pillNo{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 8px;
      border-radius:999px;
      font-size:11px;
      border:1px solid rgba(255,107,107,.30);
      background: rgba(255,107,107,.10);
      color: rgba(233,238,255,.90);
      white-space:nowrap;
    }

    /* Persona vote summary panel */
    .votePanel{
      border:1px solid var(--line);
      border-radius:16px;
      background: rgba(0,0,0,.10);
      padding:12px;
      margin-bottom:10px;
    }
    .voteHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .voteHeader .t{
      margin:0;
      font-weight:900;
      font-size:13px;
    }
    .voteHeader .small{
      margin:0;
      color: var(--muted);
      font-size:12px;
    }
    .voteRow{
      display:grid;
      grid-template-columns: 110px 1fr 88px;
      gap:10px;
      align-items:center;
      padding:8px 0;
      border-top:1px solid rgba(255,255,255,.06);
    }
    .voteRow:first-of-type{ border-top:none; }
    .voteName{
      font-weight:800;
      font-size:12px;
      color: rgba(233,238,255,.90);
    }
    .voteBar{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      position:relative;
    }
    .voteBar > span{
      position:absolute; left:0; top:0; bottom:0;
      width:0%;
      background: linear-gradient(90deg, var(--accent2), var(--accent));
      border-radius:999px;
      transition: width .18s ease;
    }
    .voteBadge{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:6px;
      font-size:11px;
      color: var(--muted);
      font-variant-numeric: tabular-nums;
    }

    /* Action Log JSON panel */
    pre.json{
      margin:0;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: rgba(233,238,255,.82);
      font-size:11px;
      line-height:1.45;
      overflow:auto;
      max-height: 220px;
    }

    /* message entrance */
    @keyframes popIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
    .msg.new{ animation: popIn .28s ease-out both; }

    .typing{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border:1px dashed rgba(255,255,255,.14);
      background: rgba(255,255,255,.02);
      border-radius:14px;
      color: var(--muted);
      font-size:12px;
    }
    .dots{ display:inline-flex; gap:4px; align-items:center; }
    .dots span{
      width:6px; height:6px; border-radius:50%;
      background: rgba(233,238,255,.35);
      display:inline-block;
      animation: blink 1s ease-in-out infinite;
    }
    .dots span:nth-child(2){ animation-delay: .15s; }
    .dots span:nth-child(3){ animation-delay: .30s; }
    @keyframes blink{
      0%, 80%, 100%{ opacity:.25; transform: translateY(0); }
      40%{ opacity:1; transform: translateY(-2px); }
    }

    .footerHint{
      margin-top:10px;
      color:rgba(233,238,255,.55);
      font-size:11px;
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    .footerHint code{
      color:rgba(233,238,255,.72);
      background: rgba(0,0,0,.20);
      border:1px solid var(--line);
      padding:2px 6px;
      border-radius:8px;
    }

    @media (max-width: 1020px){
      .layout{ flex-direction:column; }
      aside{ width:100%; }
      main{ min-height:680px; }
      input[type="range"]{ width:180px; }
      .grid2{ grid-template-columns: 1fr; height:auto; }
      .scene{ overflow:auto; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <h1>RateRocket SimLab â€” Multiâ€‘Agent + Persona Vote Demo</h1>
        <p>
          ì‹œê°„ ì§„í–‰ì— ë”°ë¼ <b>ì—ì´ì „íŠ¸ë“¤ì´ ì„œë¡œ ëŒ€í™”</b>í•˜ë©°(ì‹ í˜¸ ìš”ì•½ â†’ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± â†’ í˜ë¥´ì†Œë‚˜ â€œBook/Noâ€ íˆ¬í‘œ â†’ ê°€ë“œë ˆì¼ â†’ ì˜¤ë²„ë¼ì´ë“œ í•©ì˜ â†’ Action Log)
          ê²°ì •ì„ ë•ëŠ” í˜•íƒœë¡œ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤.
          í˜ë¥´ì†Œë‚˜ì˜ â€œë‚˜ ì—¬ê¸° ì˜¬ë˜/ì•ˆì˜¬ë˜?â€ëŠ” ë‹¨ì •ì´ ì•„ë‹ˆë¼ <b>í™•ë¥  + WTP(ìˆ˜ìš© ê°€ëŠ¥í•œ ê°€ê²©)</b>ë¡œ í‘œí˜„ë©ë‹ˆë‹¤.
        </p>
      </div>
      <div class="badge"><span class="dot"></span> Multiâ€‘Agent Visualization</div>
    </header>

    <div class="controls">
      <div class="group">
        <button id="btnPlay">Play</button>
        <button id="btnReset">Reset</button>
      </div>

      <div class="group">
        <span class="label">ì†ë„(ì••ì¶•)</span>
        <input id="speed" type="range" min="1" max="12" value="6" step="1" />
        <span class="badge" id="speedLabel">6x (ì•½ 30ì´ˆ)</span>
      </div>

      <div class="group">
        <span class="label">Seek</span>
        <input id="seek" type="range" min="0" max="180" value="0" step="0.1" />
      </div>

      <div class="group">
        <div class="toggle">
          <input id="toggleAgents" type="checkbox" checked />
          <label for="toggleAgents">ë©€í‹° ì—ì´ì „íŠ¸ í‘œì‹œ</label>
        </div>
      </div>

      <div class="time" id="timeLabel">00:00 / 03:00</div>
    </div>

    <div class="layout">
      <aside>
        <div class="timelineHeader">
          <p class="h">3ë¶„ ë°ëª¨ íƒ€ì„ë¼ì¸</p>
          <p class="sub">ì¢Œì¸¡ ë‹¨ê³„ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ êµ¬ê°„ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
        </div>
        <ul class="timeline" id="timeline"></ul>
      </aside>

      <main>
        <div class="stageHeader">
          <div class="left">
            <p class="kicker">í˜„ì¬ ë‹¨ê³„</p>
            <p class="big" id="stageTitle">â€”</p>
          </div>
          <div class="right">
            <div class="tag"><span class="miniDot"></span><span id="rangeTitle">â€”</span></div>
            <div class="tag agent" id="agentTag"><span class="miniDot"></span>Agent Room</div>
          </div>
        </div>

        <div class="progressWrap">
          <div class="progressBar"><span id="progress"></span></div>
        </div>

        <div class="scenes">
          <!-- Scene 1 -->
          <section class="scene scene1" data-scene="0">
            <h3>0:00â€“0:30 Morning Brief</h3>
            <p>ì˜¤ëŠ˜ ë°”ë€ ì‹ í˜¸ 3ê°œë§Œ ìš”ì•½í•˜ê³ , â€œì–´ë–¤ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € ë³¼ì§€â€ë¥¼ 30ì´ˆ ì•ˆì— ì •í•©ë‹ˆë‹¤.</p>

            <div class="grid2">
              <div class="card">
                <div class="cardTitle">
                  <p class="t">Morning Brief (UI)</p>
                  <span class="pill">signals</span>
                </div>

                <div class="signals">
                  <div class="signal">
                    <div class="icon warn">ğŸ«</div>
                    <div>
                      <b>Event Spike</b>
                      <span>ì£¼ë§ ëŒ€í˜• ê³µì—°/í–‰ì‚¬ ì˜ˆì •</span>
                    </div>
                  </div>
                  <div class="signal">
                    <div class="icon green">âœˆï¸</div>
                    <div>
                      <b>Flight Index â†‘</b>
                      <span>ì£¼ìš” ì¶œë°œì§€ ìš´ì„ ìƒìŠ¹</span>
                    </div>
                  </div>
                  <div class="signal">
                    <div class="icon">ğŸ¨</div>
                    <div>
                      <b>Comp Price â†‘</b>
                      <span>ê²½ìŸê°€ ìƒë‹¨ ë¶„ìœ„ìˆ˜ ì´ë™</span>
                    </div>
                  </div>
                </div>

                <div style="margin-top:12px; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background: rgba(255,255,255,.03);">
                  <div style="font-weight:900;">Decision Trigger</div>
                  <div style="color:var(--muted); font-size:12px; margin-top:4px;">â€œBase/Aggressive ë¨¼ì € ë¹„êµâ€</div>
                </div>
              </div>

              <div class="card" id="agentCard1">
                <div class="chatWrap">
                  <div class="chatHeader">
                    <div class="left">
                      <span class="roomDot"></span>
                      <div>
                        <p class="title">Agent Room</p>
                        <p class="hint">ì‹ í˜¸ë¥¼ ìš”ì•½í•˜ê³ , ë‹¤ìŒ í–‰ë™ì„ ì œì•ˆí•©ë‹ˆë‹¤</p>
                      </div>
                    </div>
                    <span class="pill">scripted</span>
                  </div>
                  <div class="chatLog" id="chatLog"></div>
                  <div class="typing" id="typing">
                    <span>next message</span>
                    <span class="dots"><span></span><span></span><span></span></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="footerHint">
              <span>Tip: â€œì˜¤ëŠ˜ ë°”ë€ 3ê°œë§Œâ€</span>
              <span>Shortcut: <code>Space</code> Play/Pause</span>
            </div>
          </section>

          <!-- Scene 2 -->
          <section class="scene scene2" data-scene="1">
            <h3>0:30â€“1:30 SimLab: 30ì¼ Ã— 3 ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±</h3>
            <p>ë³´ìˆ˜/ì¤‘ë¦½/ê³µê²© 3ì‹œë‚˜ë¦¬ì˜¤(ì´ì‚° ê°€ê²© ì‚¬ë‹¤ë¦¬ ì ìš©)ë¥¼ ìƒì„±í•˜ê³ , ë¹ ë¥´ê²Œ ë¹„êµí•©ë‹ˆë‹¤.</p>

            <div class="grid2">
              <div class="card">
                <div class="cardTitle">
                  <p class="t">SimLab (UI)</p>
                  <span class="pill">D+1 ~ D+30</span>
                </div>

                <div class="tabs">
                  <div class="tab active" id="tabC">Conservative</div>
                  <div class="tab" id="tabB">Base</div>
                  <div class="tab" id="tabA">Aggressive</div>
                </div>

                <div style="color:var(--muted); font-size:12px; line-height:1.5;">
                  ìƒ‰ì€ â€œìˆ˜ìš” íˆíŠ¸(heat)â€ ì˜ˆì‹œì…ë‹ˆë‹¤. (hot/mid/cool)
                </div>

                <div class="calendar">
                  <div class="day cool"></div><div class="day cool"></div><div class="day mid"></div><div class="day mid"></div><div class="day mid"></div><div class="day hot"></div><div class="day hot"></div>
                  <div class="day cool"></div><div class="day mid"></div><div class="day mid"></div><div class="day mid"></div><div class="day mid"></div><div class="day hot"></div><div class="day hot"></div>
                  <div class="day cool"></div><div class="day mid"></div><div class="day mid"></div><div class="day mid"></div><div class="day hot"></div><div class="day hot"></div><div class="day hot"></div>
                  <div class="day cool"></div><div class="day cool"></div><div class="day mid"></div><div class="day mid"></div><div class="day mid"></div><div class="day hot"></div><div class="day hot"></div>
                </div>

                <div style="margin-top:12px; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background: rgba(255,255,255,.03);">
                  <div style="font-weight:900;">Output</div>
                  <div style="color:var(--muted); font-size:12px; margin-top:4px;">â€œê°€ê²© ìº˜ë¦°ë” + ê·¼ê±° + ê²½ê³ â€</div>
                </div>
              </div>

              <div class="card" id="agentCard2">
                <div class="chatWrap">
                  <div class="chatHeader">
                    <div class="left">
                      <span class="roomDot"></span>
                      <div>
                        <p class="title">Agent Room</p>
                        <p class="hint">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë§Œë“¤ê³ , ê°€ë“œë ˆì¼ì„ ì œì‹œí•©ë‹ˆë‹¤</p>
                      </div>
                    </div>
                    <span class="pill">multi-agent</span>
                  </div>
                  <div class="chatLog" id="chatLog2"></div>
                  <div class="typing" id="typing2">
                    <span>next message</span>
                    <span class="dots"><span></span><span></span><span></span></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="footerHint">
              <span>Tip: â€œ30ì¼ 3íƒ­â€ì´ ê°€ì¥ ì„íŒ©íŠ¸</span>
              <span>Seek: ìƒë‹¨ ìŠ¬ë¼ì´ë”ë¡œ ë‹¨ê³„ ì´ë™</span>
            </div>
          </section>

          <!-- Scene 3 -->
          <section class="scene scene3" data-scene="2">
            <h3>1:30â€“2:20 ë‚ ì§œ í´ë¦­: í˜ë¥´ì†Œë‚˜ â€œBook/Noâ€ + í™•ë¥  + WTP</h3>
            <p>ì¼ë°˜ ê³ ê°ì„ â€˜1ëª…â€™ìœ¼ë¡œ ë‹¨ì •í•˜ì§€ ì•Šê³ , <b>ëŒ€í‘œ ì„¸ê·¸ë¨¼íŠ¸ í˜ë¥´ì†Œë‚˜</b>ê°€ â€œì˜¬ë˜/ì•ˆì˜¬ë˜â€ë¥¼ <b>í™•ë¥  + ìˆ˜ìš©ê°€ê²©(WTP)</b>ë¡œ ì œì‹œí•©ë‹ˆë‹¤.</p>

            <div class="grid2">
              <div class="card">
                <div class="cardTitle">
                  <p class="t">Date Detail (UI)</p>
                  <span class="pill">D+9 example</span>
                </div>

                <div class="priceBox">
                  <div>
                    <div class="small">Recommended</div>
                    <div class="bigPrice">â‚© 165,000</div>
                  </div>
                  <div style="text-align:right">
                    <div class="small">combined_score</div>
                    <div style="font-weight:900; font-size:18px;">72.4</div>
                  </div>
                </div>

                <div class="bars">
                  <div class="barRow">
                    <div>travel_score</div>
                    <div class="bar"><span style="--w:30%"></span></div>
                    <div style="text-align:right;">30%</div>
                  </div>
                  <div class="barRow">
                    <div>occupancy</div>
                    <div class="bar"><span style="--w:50%"></span></div>
                    <div style="text-align:right;">50%</div>
                  </div>
                  <div class="barRow">
                    <div>air_norm</div>
                    <div class="bar"><span style="--w:10%"></span></div>
                    <div style="text-align:right;">10%</div>
                  </div>
                  <div class="barRow">
                    <div>lux_norm</div>
                    <div class="bar"><span style="--w:10%"></span></div>
                    <div style="text-align:right;">10%</div>
                  </div>
                </div>

                <div class="warnBox">
                  ê²½ê³  ì˜ˆì‹œ: ê²½ìŸê°€ ì»¤ë²„ë¦¬ì§€ 78% â†’ â€œê³µê²©ì  ì¸ìƒì€ ë³´ìˆ˜ì ìœ¼ë¡œ í•´ì„â€
                </div>
              </div>

              <div class="card" id="agentCard3">
                <div class="chatWrap">
                  <div class="chatHeader">
                    <div class="left">
                      <span class="roomDot"></span>
                      <div>
                        <p class="title">Agent Room</p>
                        <p class="hint">í˜ë¥´ì†Œë‚˜ íˆ¬í‘œ + ê°€ë“œë ˆì¼ + í•©ì˜</p>
                      </div>
                    </div>
                    <span class="pill">vote</span>
                  </div>

                  <!-- Vote Panel -->
                  <div class="votePanel" id="votePanel">
                    <div class="voteHeader">
                      <p class="t">Persona Vote Summary</p>
                      <p class="small">ê¸°ì¤€ê°€ê²©: â‚©165,000</p>
                    </div>

                    <div class="voteRow" data-persona="family">
                      <div class="voteName">Family</div>
                      <div class="voteBar"><span id="bar_family"></span></div>
                      <div class="voteBadge" id="badge_family">
                        <span>â€”</span><span>WTP â€”</span>
                      </div>
                    </div>

                    <div class="voteRow" data-persona="budget">
                      <div class="voteName">Budget</div>
                      <div class="voteBar"><span id="bar_budget"></span></div>
                      <div class="voteBadge" id="badge_budget">
                        <span>â€”</span><span>WTP â€”</span>
                      </div>
                    </div>

                    <div class="voteRow" data-persona="biz">
                      <div class="voteName">Business</div>
                      <div class="voteBar"><span id="bar_biz"></span></div>
                      <div class="voteBadge" id="badge_biz">
                        <span>â€”</span><span>WTP â€”</span>
                      </div>
                    </div>
                  </div>

                  <div class="chatLog" id="chatLog3"></div>
                  <div class="typing" id="typing3">
                    <span>next message</span>
                    <span class="dots"><span></span><span></span><span></span></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="footerHint">
              <span>Tip: â€œBook/Noë¥¼ í™•ë¥  + WTPë¡œâ€</span>
              <span>Note: ìˆ«ì ê³„ì‚°ì€ ì—”ì§„, ëŒ€í™”ëŠ” í•´ì„/ê·¼ê±°</span>
            </div>
          </section>

          <!-- Scene 4 -->
          <section class="scene scene4" data-scene="3">
            <h3>2:20â€“2:50 ì„ íƒ + ì˜¤ë²„ë¼ì´ë“œ</h3>
            <p>í˜„ì¥ ì •ë³´(ë‹¨ì²´/í”„ë¡œëª¨ì…˜/ì˜¤ë„ˆ ì§€ì‹œ ë“±)ë¥¼ ë°˜ì˜í•´ ì¼ë¶€ ë‚ ì§œë§Œ ì¡°ì •í•©ë‹ˆë‹¤.</p>

            <div class="grid2">
              <div class="card">
                <div class="cardTitle">
                  <p class="t">Overrides (UI)</p>
                  <span class="pill">2â€“3 days</span>
                </div>

                <table class="table">
                  <thead>
                    <tr><th>ë‚ ì§œ</th><th>ì¶”ì²œê°€</th><th>ì˜¤ë²„ë¼ì´ë“œ</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>D+8</td><td>â‚© 160,000</td><td>â€”</td></tr>
                    <tr><td>D+9</td><td>â‚© 165,000</td><td>â‚© 170,000 <span class="editPencil">âœ</span></td></tr>
                    <tr><td>D+10</td><td>â‚© 165,000</td><td>â€”</td></tr>
                    <tr><td>D+11</td><td>â‚© 155,000</td><td>â‚© 150,000 <span class="editPencil">âœ</span></td></tr>
                  </tbody>
                </table>

                <div style="margin-top:12px; padding:10px 12px; border-radius:14px; border:1px solid var(--line); background: rgba(255,255,255,.03);">
                  <div style="font-weight:900;">Selected Scenario</div>
                  <div style="color:var(--muted); font-size:12px; margin-top:4px;">Base (risk=2) + overrides</div>
                </div>
              </div>

              <div class="card" id="agentCard4">
                <div class="chatWrap">
                  <div class="chatHeader">
                    <div class="left">
                      <span class="roomDot"></span>
                      <div>
                        <p class="title">Agent Room</p>
                        <p class="hint">ì˜¤ë²„ë¼ì´ë“œ ì‚¬ìœ ë¥¼ í•©ì˜í•˜ê³ , ë¡œê·¸ ì¤€ë¹„</p>
                      </div>
                    </div>
                    <span class="pill">governance</span>
                  </div>
                  <div class="chatLog" id="chatLog4"></div>
                  <div class="typing" id="typing4">
                    <span>next message</span>
                    <span class="dots"><span></span><span></span><span></span></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="footerHint">
              <span>Tip: â€œì „ì²´ ìë™ + ì¼ë¶€ ìˆ˜ë™â€</span>
              <span>Output: Action Logë¡œ ë‚¨ê¸°ê¸°</span>
            </div>
          </section>

          <!-- Scene 5 -->
          <section class="scene scene5" data-scene="4">
            <h3>2:50â€“3:00 Action Log ì €ì¥ + Replay</h3>
            <p>ê²°ì •/ê·¼ê±° ìŠ¤ëƒ…ìƒ·ì„ ì €ì¥í•´ Replay ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê³ , ë‹¤ìŒ ì£¼ ë³´ê³ ì„œì— ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

            <div class="grid2">
              <div class="card">
                <div class="cardTitle">
                  <p class="t">Action Log (UI)</p>
                  <span class="pill">saved</span>
                </div>

                <div style="display:flex; flex-direction:column; gap:10px;">
                  <div style="border:1px solid var(--line); background: rgba(255,255,255,.03); border-radius:14px; padding:10px 12px;">
                    <div style="font-weight:900; font-size:12px;">ì˜¤ëŠ˜: Base + 2ì¼ ì˜¤ë²„ë¼ì´ë“œ</div>
                    <div style="color:var(--muted); font-size:12px; margin-top:4px;">D+1~D+30 / ê·¼ê±° ìŠ¤ëƒ…ìƒ· í¬í•¨</div>
                  </div>

                  <div style="border:1px solid rgba(122,162,255,.35); background: rgba(122,162,255,.10); border-radius:14px; padding:10px 12px;">
                    <div style="font-weight:900; font-size:12px;">â–¶ Replay Now</div>
                    <div style="color:rgba(233,238,255,.75); font-size:12px; margin-top:4px;">ì„ íƒ ë‹¹ì‹œ í™”ë©´/ê·¼ê±° ì¬í˜„</div>
                  </div>
                </div>

                <div style="margin-top:12px; color:var(--muted); font-size:12px; line-height:1.5;">
                  MVP KPI: ì •í™•ë„ ëŒ€ì‹  <b>Time-to-Decision</b> + <b>Action Log ì±„íƒë¥ </b>
                </div>
              </div>

              <div class="card" id="agentCard5">
                <div class="chatWrap">
                  <div class="chatHeader">
                    <div class="left">
                      <span class="roomDot"></span>
                      <div>
                        <p class="title">Agent Room</p>
                        <p class="hint">ìŠ¤í¬ë¼ì´ë¸Œê°€ â€œêµ¬ì¡°í™” ë¡œê·¸â€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤</p>
                      </div>
                    </div>
                    <span class="pill">audit-ready</span>
                  </div>

                  <div class="votePanel" style="margin-bottom:10px;">
                    <div class="voteHeader">
                      <p class="t">Structured Action Log</p>
                      <p class="small">Replay ê°€ëŠ¥í•œ ìŠ¤ëƒ…ìƒ·</p>
                    </div>
                    <pre class="json" id="logJson">{}</pre>
                  </div>

                  <div class="chatLog" id="chatLog5"></div>
                  <div class="typing" id="typing5">
                    <span>next message</span>
                    <span class="dots"><span></span><span></span><span></span></span>
                  </div>
                </div>
              </div>
            </div>

            <div class="footerHint">
              <span>Tip: â€œReplay ê°€ëŠ¥í•œ ê²°ì •â€ì´ B2B ì‹ ë¢°</span>
              <span>Done: 3ë¶„ ë°ëª¨ ì™„ì£¼</span>
            </div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <script>
    // ----- Timeline definition (seconds)
    const steps = [
      { idx: 1, title: "Morning Brief", range: "0:00â€“0:30", start: 0, end: 30,
        desc: "ì˜¤ëŠ˜ ë°”ë€ ì‹ í˜¸ 3ê°œë§Œ ë³´ì—¬ì£¼ê¸°", scene: 0 },
      { idx: 2, title: "SimLab (30ì¼ 3ì‹œë‚˜ë¦¬ì˜¤)", range: "0:30â€“1:30", start: 30, end: 90,
        desc: "D+1~D+30, ë³´ìˆ˜/ì¤‘ë¦½/ê³µê²© 3ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± â†’ ìº˜ë¦°ë” ë¹„êµ", scene: 1 },
      { idx: 3, title: "ë‚ ì§œ í´ë¦­(í˜ë¥´ì†Œë‚˜ íˆ¬í‘œ)", range: "1:30â€“2:20", start: 90, end: 140,
        desc: "Book/No + í™•ë¥  + WTPë¡œ í•´ì„", scene: 2 },
      { idx: 4, title: "ì„ íƒ + ì˜¤ë²„ë¼ì´ë“œ", range: "2:20â€“2:50", start: 140, end: 170,
        desc: "íŠ¹ì • 2â€“3ì¼ë§Œ ìˆ˜ë™ ì¡°ì •", scene: 3 },
      { idx: 5, title: "Action Log ì €ì¥ + Replay", range: "2:50â€“3:00", start: 170, end: 180,
        desc: "êµ¬ì¡°í™” ë¡œê·¸ ì €ì¥ â†’ Replay", scene: 4 }
    ];
    const total = 180;

    // ----- Agent definitions
    const agents = {
      rm:      { name:"RM", role:"Revenue Manager", avatar:"RM" },
      scout:   { name:"Signal Scout", role:"Signals", avatar:"S" },
      event:   { name:"Event Agent", role:"Event", avatar:"ğŸ«" },
      flight:  { name:"Flight Agent", role:"Air", avatar:"âœˆ" },
      comp:    { name:"Comp Watch", role:"Competitor", avatar:"ğŸ¨" },
      sim:     { name:"Sim Engine", role:"Scenario", avatar:"Î£" },
      risk:    { name:"Risk Officer", role:"Governance", avatar:"!" },
      family:  { name:"Family Persona", role:"Demand", avatar:"F" },
      budget:  { name:"Budget Persona", role:"Demand", avatar:"B" },
      biz:     { name:"Business Persona", role:"Demand", avatar:"W" },
      scribe:  { name:"Scribe", role:"Action Log", avatar:"âœ" }
    };

    // Messages by scene (each has absolute 'at' seconds)
    // kind: signal | scenario | guardrail | question | persona | decision | log
    const messages = [
      // Scene 1: Morning Brief
      { id:"m1", at: 4,  scene:0, a:"scout",  kind:"signal",
        t:"ì˜¤ëŠ˜ ë³€ê²½ ì‹ í˜¸ ìŠ¤ìº” ì™„ë£Œ. ìƒìœ„ 3ê°œë§Œ ìš”ì•½í•©ë‹ˆë‹¤.", sub:"(ì´ë²¤íŠ¸/í•­ê³µ/ê²½ìŸê°€ ì¤‘ì‹¬)",
        data:{ "Output":"Top 3 signals", "Next":"Generate 30-day scenarios" } },
      { id:"m2", at: 7,  scene:0, a:"event",  kind:"signal",
        t:"ì£¼ë§ ëŒ€í˜• ê³µì—°/í–‰ì‚¬ ê°ì§€ â†’ ìˆ˜ìš” ìƒí–¥ ê°€ëŠ¥.", sub:"concert_score â†‘",
        data:{ "Impact":"Demand up", "Where":"D+8 ~ D+11" } },
      { id:"m3", at: 11, scene:0, a:"flight", kind:"signal",
        t:"í•­ê³µ ì§€ìˆ˜ +0.12(7ì¼ ëŒ€ë¹„). ìœ ì… ê°€ëŠ¥ì„±â†‘", sub:"air_norm â†‘",
        data:{ "Î”Air index":"+0.12", "Confidence":"Medium" } },
      { id:"m4", at: 16, scene:0, a:"comp",   kind:"signal",
        t:"ê²½ìŸê°€ ìƒë‹¨ ë¶„ìœ„ìˆ˜ ì´ë™. ìƒëŒ€ê°€ê²© ë©”ë¦¬íŠ¸ ì•½í™”.", sub:"lux_norm â†‘",
        data:{ "Signal":"Competitors up", "Coverage":"78% (warning)" } },
      { id:"m5", at: 24, scene:0, a:"rm",     kind:"decision",
        t:"ì¢‹ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ì€ Base/Aggressive ë¨¼ì € ë¹„êµí•˜ê³ , ë¦¬ìŠ¤í¬ ê²½ê³ ë„ ê°™ì´ ë³´ì£ .", sub:"â†’ SimLab 30ì¼ ìƒì„±",
        data:{ "Decision":"Compare Base vs Aggressive", "Reason":"Signals strong + comp up" } },

      // Scene 2: SimLab
      { id:"m6", at: 33, scene:1, a:"sim",   kind:"scenario",
        t:"30ì¼ Ã— 3ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì‹œì‘(ì´ì‚° ê°€ê²© ì‚¬ë‹¤ë¦¬ ì ìš©).", sub:"risk=1/2/3",
        data:{ "Horizon":"D+1~D+30", "Scenarios":"Conservative/Base/Aggressive", "Mode":"Discrete price list" } },
      { id:"m7", at: 44, scene:1, a:"sim",   kind:"scenario",
        t:"ìƒì„± ì™„ë£Œ. hot/mid/cool ì¼ìë¥¼ ë¨¼ì € í™•ì¸í•˜ì„¸ìš”.", sub:"(ë°ëª¨ìš© íˆíŠ¸ë§µ)",
        data:{ "Output":"Price calendar + reasons", "Latency":"~seconds (demo)" } },
      { id:"m8", at: 52, scene:1, a:"risk",  kind:"guardrail",
        t:"ê°€ë“œë ˆì¼ ì œì•ˆ: ì»¤ë²„ë¦¬ì§€ 85% ë¯¸ë§Œì´ë©´ ì¸ìƒ í­ ìƒí•œì„ ë‘¡ë‹ˆë‹¤.", sub:"coverage warning",
        data:{ "Guardrail":"+â‚©5,000 cap", "Condition":"competitor_coverage >= 85%", "Why":"avoid overreaction when data incomplete" } },
      { id:"m9", at: 68, scene:1, a:"rm",    kind:"decision",
        t:"OK. Baseë¡œ ê°€ë˜, ê³ ìˆ˜ìš” ì¼ìë§Œ ì œí•œì ìœ¼ë¡œ ì˜¬ë¦½ë‹ˆë‹¤.", sub:"(ì „ëµ)",
        data:{ "Strategy":"Base + limited overrides", "Respect":"Risk guardrails" } },

      // Scene 3: Date click + persona votes
      { id:"m10", at: 94, scene:2, a:"rm",    kind:"question",
        t:"D+9 í´ë¦­. ì´ ë‚ ì§œë¥¼ â‚©165,000ë¡œ ë‘ë©´ â€˜ì¼ë°˜ ê³ ê°â€™ì€ ì˜¬ê¹Œìš”?", sub:"(í˜ë¥´ì†Œë‚˜ íˆ¬í‘œ ìš”ì²­)",
        data:{ "Target date":"D+9", "Price":"â‚©165,000" } },
      { id:"m11", at: 100, scene:2, a:"sim",  kind:"scenario",
        t:"D+9 ì¶”ì²œê°€ â‚©165,000 / combined_score 72.4", sub:"travel+occ+air+lux",
        data:{ "Score":"72.4", "Main drivers":"occupancy + travel_score", "Data quality":"competitor_coverage=78% (warn)" } },

      // Persona votes (Book/No + prob + WTP)
      { id:"m12", at: 106, scene:2, a:"family", kind:"persona",
        t:"(Family) ì´ ê°€ê²©ì´ë©´ â€˜ì˜ˆì•½í•  í™•ë¥ â€™ì´ ë” ë†’ìŠµë‹ˆë‹¤.", sub:"ì´ë²¤íŠ¸+ë‚ ì”¨ ì˜í–¥",
        vote:{ persona:"family", verdict:"BOOK", p:0.62, wtp:170000 },
        data:{ "Verdict":"BOOK", "Book probability":"0.62", "WTP":"â‚©170,000", "Key reason":"Event-driven leisure" } },
      { id:"m13", at: 112, scene:2, a:"budget", kind:"persona",
        t:"(Budget) ì´ ê°€ê²©ì´ë©´ â€˜ë‹¤ë¥¸ í˜¸í…”ë¡œ ê°ˆ í™•ë¥ â€™ì´ í½ë‹ˆë‹¤.", sub:"ê°€ê²© ë¯¼ê° ì„¸ê·¸ë¨¼íŠ¸",
        vote:{ persona:"budget", verdict:"NO", p:0.58, wtp:145000 },
        data:{ "Verdict":"NO", "Leave probability":"0.58", "WTP":"â‚©145,000", "Key reason":"price-sensitive vs competitors" } },
      { id:"m14", at: 118, scene:2, a:"biz", kind:"persona",
        t:"(Business) ì¼ì • ê³ ì • ìˆ˜ìš”ëŠ” ìˆ˜ìš© ê°€ëŠ¥. í‰ì¼ì´ë©´ ë” ê°•í•©ë‹ˆë‹¤.", sub:"ìš”ì¼/ì¶œì¥ ì˜í–¥",
        vote:{ persona:"biz", verdict:"BOOK", p:0.71, wtp:180000 },
        data:{ "Verdict":"BOOK", "Book probability":"0.71", "WTP":"â‚©180,000", "Key reason":"weekday business travel" } },

      { id:"m15", at: 130, scene:2, a:"risk", kind:"guardrail",
        t:"ê²°ë¡ (ê°€ë“œë ˆì¼): D+9ì€ +â‚©5,000ê¹Œì§„ OK. ê·¸ ì´ìƒì€ ì»¤ë²„ë¦¬ì§€ ê°œì„  ì „ê¹Œì§€ ë³´ë¥˜.", sub:"ì•ˆì „ ì¥ì¹˜",
        data:{ "Guardrail":"+â‚©5,000 cap", "Applies to":"D+9", "Reason":"competitor_coverage=78% < 85%" } },

      // Scene 4: Override decision
      { id:"m16", at: 144, scene:3, a:"rm",     kind:"decision",
        t:"ê²°ì •: Base(risk=2) ì±„íƒ. D+9ì€ +5k, D+11ì€ -5kë¡œ ì˜¤ë²„ë¼ì´ë“œ.", sub:"í˜„ì¥ ì •ë³´ ë°˜ì˜",
        data:{ "Scenario":"Base (risk=2)", "Overrides":["D+9 +â‚©5,000","D+11 -â‚©5,000"], "Why":"event bump + demand risk day" } },
      { id:"m17", at: 154, scene:3, a:"risk",   kind:"guardrail",
        t:"ì˜¤ë²„ë¼ì´ë“œ ì‚¬ìœ ë¥¼ ë¡œê·¸ì— ë‚¨ê²¨ì•¼ í•©ë‹ˆë‹¤(ê°ì‚¬/ë¦¬í”Œë ˆì´ ëª©ì ).", sub:"governance",
        data:{ "Required fields":"override_reason, data_quality, approver", "Policy":"audit-ready decisions" } },
      { id:"m18", at: 162, scene:3, a:"scribe", kind:"log",
        t:"Action Log ì´ˆì•ˆ ìƒì„± ì¤‘â€¦ (ì„ íƒ ì‹œë‚˜ë¦¬ì˜¤ + ì˜¤ë²„ë¼ì´ë“œ + ê·¼ê±° ìŠ¤ëƒ…ìƒ·)", sub:"ìë™ ìš”ì•½",
        data:{ "Draft":"true", "Will include":"signals, votes, guardrails, overrides" } },

      // Scene 5: Log saved
      { id:"m19", at: 172, scene:4, a:"scribe", kind:"log",
        t:"Action Log ì €ì¥ ì™„ë£Œ. Replayë¡œ ë™ì¼ ê·¼ê±°/í™”ë©´ ì¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤.", sub:"run_id ì—°ê²°",
        log:{
          action_id:"AL-0001",
          run_time:"~22s (demo)",
          horizon:"D+1~D+30",
          selected_scenario:"Base (risk=2)",
          overrides:[
            { date:"D+9", delta:"+â‚©5,000", reason:"Event-driven demand; family persona supports; guardrail cap applied" },
            { date:"D+11", delta:"-â‚©5,000", reason:"Data coverage warning + cautious stance" }
          ],
          persona_votes:{
            family:{ verdict:"BOOK", p:0.62, wtp:170000 },
            budget:{ verdict:"NO",   p:0.58, wtp:145000 },
            business:{ verdict:"BOOK", p:0.71, wtp:180000 }
          },
          guardrails:[
            { rule:"+â‚©5,000 cap", condition:"competitor_coverage >= 85% else cap", applied_to:["D+9"] }
          ],
          data_quality:{ competitor_coverage:0.78, notes:"below threshold â†’ conservative cap" },
          kpi:{ primary:["time_to_decision","action_log_adoption"], secondary:["calibration later"] }
        },
        data:{ "Saved":"true", "Replay":"enabled", "Audit":"ready" } },
      { id:"m20", at: 176, scene:4, a:"rm",     kind:"decision",
        t:"ì¢‹ì•„ìš”. ì´ì œ ê²°ì • ì‹œê°„(Time-to-Decision)ê³¼ ë¡œê·¸ ì±„íƒë¥ ì´ KPIë¡œ ì¸¡ì •ë©ë‹ˆë‹¤.", sub:"MVP success metric",
        data:{ "MVP KPI":["Time-to-Decision","Action Log adoption"], "Accuracy":"not primary (yet)" } }
    ];

    // ----- DOM
    const timelineEl = document.getElementById("timeline");
    const stageTitleEl = document.getElementById("stageTitle");
    const rangeTitleEl = document.getElementById("rangeTitle");
    const progressEl = document.getElementById("progress");
    const timeLabelEl = document.getElementById("timeLabel");
    const btnPlay = document.getElementById("btnPlay");
    const btnReset = document.getElementById("btnReset");
    const speedInput = document.getElementById("speed");
    const speedLabel = document.getElementById("speedLabel");
    const seek = document.getElementById("seek");
    const agentTag = document.getElementById("agentTag");
    const toggleAgents = document.getElementById("toggleAgents");

    const scenes = Array.from(document.querySelectorAll(".scene"));
    const chatLogs = [
      document.getElementById("chatLog"),
      document.getElementById("chatLog2"),
      document.getElementById("chatLog3"),
      document.getElementById("chatLog4"),
      document.getElementById("chatLog5")
    ];
    const typers = [
      document.getElementById("typing"),
      document.getElementById("typing2"),
      document.getElementById("typing3"),
      document.getElementById("typing4"),
      document.getElementById("typing5")
    ];

    const voteEls = {
      family: { bar: document.getElementById("bar_family"), badge: document.getElementById("badge_family") },
      budget: { bar: document.getElementById("bar_budget"), badge: document.getElementById("badge_budget") },
      biz:    { bar: document.getElementById("bar_biz"), badge: document.getElementById("badge_biz") }
    };
    const logJsonEl = document.getElementById("logJson");

    // Build timeline list
    const stepNodes = steps.map(s => {
      const li = document.createElement("li");
      li.className = "step";
      li.dataset.start = s.start;
      li.dataset.end = s.end;
      li.dataset.scene = s.scene;
      li.innerHTML = `
        <div class="idx">${s.idx}</div>
        <div class="meta">
          <p class="range">${s.range}</p>
          <p class="name">${s.title}</p>
          <p class="desc">${s.desc}</p>
        </div>
      `;
      li.addEventListener("click", () => {
        setTime(s.start + 0.01);
        pause();
        render(true);
      });
      timelineEl.appendChild(li);
      return li;
    });

    // Playback state
    let playing = false;
    let lastNow = null;
    let t = 0;
    let speed = Number(speedInput.value);

    function fmt(sec){
      const s = Math.max(0, Math.min(total, sec));
      const m = Math.floor(s / 60);
      const r = Math.floor(s % 60);
      return `${String(m).padStart(2,"0")}:${String(r).padStart(2,"0")}`;
    }

    function formatKRW(n){
      try{
        return "â‚©" + n.toLocaleString("ko-KR");
      }catch(e){
        return "â‚©" + String(n);
      }
    }

    function updateSpeedLabel(){
      speed = Number(speedInput.value);
      const realSeconds = Math.round(total / speed);
      speedLabel.textContent = `${speed}x (ì•½ ${realSeconds}ì´ˆ)`;
    }
    speedInput.addEventListener("input", () => { updateSpeedLabel(); render(false); });

    // Scrubber
    seek.addEventListener("input", () => {
      setTime(Number(seek.value));
      pause();
      render(true);
    });

    function setTime(sec){
      t = Math.max(0, Math.min(total, sec));
      seek.value = t;
    }

    function findActiveStep(sec){
      if (sec >= total) return steps.length - 1;
      return steps.findIndex(s => sec >= s.start && sec < s.end);
    }

    function activateScene(sceneIdx){
      scenes.forEach(el => el.classList.toggle("active", Number(el.dataset.scene) === sceneIdx));
    }

    function updateSimLabTabs(active){
      const tabC = document.getElementById("tabC");
      const tabB = document.getElementById("tabB");
      const tabA = document.getElementById("tabA");
      if (!tabC || !tabB || !tabA) return;

      if (!active){
        tabC.classList.add("active");
        tabB.classList.remove("active");
        tabA.classList.remove("active");
        return;
      }
      const phase = (t - 30) / 60; // 0..1 in scene2
      const k = Math.floor(phase * 3); // 0..2
      tabC.classList.toggle("active", k === 0);
      tabB.classList.toggle("active", k === 1);
      tabA.classList.toggle("active", k >= 2);
    }

    function buildKV(data){
      const keys = Object.keys(data || {});
      if (!keys.length) return "";
      const rows = keys.map(k => `<div class="k">${escapeHTML(k)}</div><div class="v">${escapeHTML(String(data[k]))}</div>`).join("");
      return `<div class="kv">${rows}</div>`;
    }

    function badgeForKind(kind, vote){
      if (kind !== "persona" || !vote) return "";
      const ok = vote.verdict === "BOOK";
      const pct = Math.round((vote.p || 0) * 100);
      const text = ok ? `BOOK ${pct}%` : `NO ${pct}%`;
      const cls = ok ? "pillOk" : "pillNo";
      return `<span class="${cls}">${text}</span>`;
    }

    function escapeHTML(str){
      return str.replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function buildMsgNode(m, isNew){
      const a = agents[m.a] || { name:m.a, role:"Agent", avatar:"?" };
      const wrap = document.createElement("div");
      wrap.className = "msg" + (isNew ? " new" : "");
      const badge = badgeForKind(m.kind, m.vote);
      wrap.innerHTML = `
        <div class="avatar" aria-hidden="true">${a.avatar}</div>
        <div class="bubble">
          <div class="meta">
            <div class="name">${a.name} <span class="role">${a.role}</span> ${badge}</div>
            <div class="ts">${fmt(m.at)}</div>
          </div>
          <div class="text">${escapeHTML(m.t)}</div>
          ${m.sub ? `<div class="sub">${escapeHTML(m.sub)}</div>` : ``}
          ${m.data ? buildKV(m.data) : ``}
        </div>
      `;
      return wrap;
    }

    function computeVotesUpToTime(){
      const vs = { family:null, budget:null, biz:null };
      const upto = messages.filter(m => m.scene === 2 && m.kind === "persona" && m.at <= t && m.vote);
      for (const m of upto){
        if (m.vote && vs[m.vote.persona] == null){
          vs[m.vote.persona] = m.vote;
        } else if (m.vote && vs[m.vote.persona] != null){
          // keep the latest vote if multiple
          vs[m.vote.persona] = m.vote;
        }
      }
      return vs;
    }

    function renderVotePanel(){
      const vs = computeVotesUpToTime();
      for (const key of ["family","budget","biz"]){
        const el = voteEls[key];
        if (!el || !el.bar || !el.badge) continue;

        const v = vs[key];
        if (!v){
          el.bar.style.width = "0%";
          el.badge.innerHTML = `<span>â€”</span><span>WTP â€”</span>`;
          continue;
        }
        const pct = Math.round((v.p || 0) * 100);
        el.bar.style.width = pct + "%";
        const verdict = v.verdict === "BOOK" ? "BOOK" : "NO";
        const verdictHtml = v.verdict === "BOOK"
          ? `<span style="color:rgba(82,224,196,.95); font-weight:900;">${verdict} ${pct}%</span>`
          : `<span style="color:rgba(255,107,107,.95); font-weight:900;">${verdict} ${pct}%</span>`;
        el.badge.innerHTML = `${verdictHtml}<span>WTP ${escapeHTML(formatKRW(v.wtp || 0))}</span>`;
      }
    }

    function renderLogJson(){
      if (!logJsonEl) return;
      const saved = messages
        .filter(m => m.scene === 4 && m.kind === "log" && m.at <= t && m.log)
        .sort((a,b) => a.at - b.at)
        .slice(-1)[0];

      if (!saved){
        logJsonEl.textContent = "{}";
        return;
      }
      try{
        logJsonEl.textContent = JSON.stringify(saved.log, null, 2);
      }catch(e){
        logJsonEl.textContent = "{ /* failed to stringify */ }";
      }
    }

    function renderChat(sceneIdx, hardReset=false){
      if (!toggleAgents.checked){
        agentTag.style.display = "none";
        const cards = document.querySelectorAll('[id^="agentCard"]');
        cards.forEach(c => c.style.display = "none");
        return;
      } else {
        agentTag.style.display = "inline-flex";
        const cards = document.querySelectorAll('[id^="agentCard"]');
        cards.forEach(c => c.style.display = "block");
      }

      // Determine visible messages up to current time within current scene
      const visible = messages
        .filter(m => m.scene === sceneIdx && m.at <= t)
        .sort((a,b) => a.at - b.at);

      const log = chatLogs[sceneIdx];
      const typer = typers[sceneIdx];
      if (!log || !typer) return;

      if (hardReset){
        log.innerHTML = "";
      }

      // Rebuild if scrubbed backward
      if (log.children.length > visible.length){
        log.innerHTML = "";
      }

      // Append new messages
      const startIdx = log.children.length;
      for (let i=startIdx; i<visible.length; i++){
        log.appendChild(buildMsgNode(visible[i], true));
      }

      // Typing indicator
      const nextMsg = messages
        .filter(m => m.scene === sceneIdx && m.at > t)
        .sort((a,b) => a.at - b.at)[0];
      typer.style.display = nextMsg ? "flex" : "none";

      // Auto-scroll when playing and new messages appear
      if (playing && visible.length > startIdx){
        log.scrollTop = log.scrollHeight;
      }
    }

    function render(hardReset=false){
      const idx = findActiveStep(t);
      const step = steps[Math.max(0, idx)];

      // Timeline highlight
      stepNodes.forEach((node, i) => node.classList.toggle("active", i === idx));

      // Header
      stageTitleEl.textContent = step ? step.title : "â€”";
      rangeTitleEl.textContent = step ? step.range : "â€”";

      // progress & time
      progressEl.style.width = `${(t / total) * 100}%`;
      timeLabelEl.textContent = `${fmt(t)} / ${fmt(total)}`;

      // Scene
      if (step) activateScene(step.scene);
      updateSimLabTabs(step && step.scene === 1);

      // Scene-specific structured UI
      if (step && step.scene === 2){
        renderVotePanel();
      }
      if (step && step.scene === 4){
        renderLogJson();
      }

      // Chat rendering
      if (step) renderChat(step.scene, hardReset);
    }

    function loop(now){
      if (!playing) return;
      if (lastNow == null) lastNow = now;
      const dt = (now - lastNow) / 1000;
      lastNow = now;

      setTime(t + dt * speed);

      if (t >= total){
        setTime(total);
        pause();
        render(false);
        return;
      }

      render(false);
      requestAnimationFrame(loop);
    }

    function play(){
      if (playing) return;
      playing = true;
      btnPlay.textContent = "Pause";
      lastNow = null;
      requestAnimationFrame(loop);
    }

    function pause(){
      playing = false;
      btnPlay.textContent = "Play";
      lastNow = null;
    }

    btnPlay.addEventListener("click", () => { if (playing) pause(); else play(); });
    btnReset.addEventListener("click", () => { pause(); setTime(0); render(true); });

    toggleAgents.addEventListener("change", () => { render(true); });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space"){
        e.preventDefault();
        if (playing) pause(); else play();
      }
    });

    // Init
    updateSpeedLabel();
    render(true);
  </script>
</body>
</html>
